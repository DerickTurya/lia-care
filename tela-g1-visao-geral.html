<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Licen√ßas - Lia Care</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/lia-sync.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">LIA</div>
                <div class="logo-text">
                    <h1>Lia Care</h1>
                    <p>Licen√ßas e Afastamentos</p>
                </div>
            </div>
            <div class="user-info">
                <span>üëî</span>
                <span>Maria Santos - Gestora</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Gest√£o de Licen√ßas da Equipe</h2>
                <p class="card-subtitle">Acompanhe o status das licen√ßas m√©dicas da sua equipe</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Colaboradores afastados</div>
                    <div class="stat-value" id="statActive">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Licen√ßas cadastradas</div>
                    <div class="stat-value" id="statTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Novas (n√£o visualizadas)</div>
                    <div class="stat-value" style="color: var(--warning-color);" id="statPending">0</div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Notifica√ß√µes em tempo real -->
            <div id="notificationBanner" style="display: none; background: linear-gradient(135deg, #4299E1 0%, #6B46C1 100%); color: white; padding: 16px 20px; border-radius: 12px; margin-bottom: 24px; animation: slideDown 0.4s ease-out;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 24px;">üîî</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; margin-bottom: 4px;" id="notifTitle">Nova licen√ßa cadastrada!</div>
                        <div style="font-size: 14px; opacity: 0.95;" id="notifMessage">Um colaborador acabou de cadastrar uma licen√ßa</div>
                    </div>
                    <button onclick="dismissNotification()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Ver
                    </button>
                </div>
            </div>

            <style>
                @keyframes slideDown {
                    from {
                        opacity: 0;
                        transform: translateY(-20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                .pulse {
                    animation: pulse 2s infinite;
                }
            </style>

            <div class="ai-message">
                <div class="ai-message-header">
                    <span>ü§ñ</span>
                    <span>LIA - Assistente Inteligente</span>
                </div>
                <div class="ai-message-content">
                    <p style="margin-bottom: 16px; font-size: 16px;"><strong>Ol√°, Maria! üëã Bem-vinda ao seu painel.</strong></p>
                    <p style="margin-bottom: 12px;">Estou monitorando as licen√ßas da sua equipe em tempo real.</p>
                    <p style="margin-bottom: 12px; font-size: 15px; font-weight: 600;">O que eu fa√ßo por voc√™:</p>
                    <ul style="margin: 12px 0; padding-left: 20px; line-height: 2;">
                        <li>üìä <strong>Consolido</strong> todas as informa√ß√µes em um s√≥ lugar</li>
                        <li>üîî <strong>Te notifico</strong> sobre novos afastamentos</li>
                        <li>‚ö†Ô∏è <strong>Destaco</strong> pend√™ncias que precisam de aten√ß√£o</li>
                        <li>üìà <strong>Acompanho</strong> prazos e processos do INSS</li>
                        <li>‚úÖ <strong>Mantenho tudo</strong> organizado automaticamente</li>
                    </ul>
                    <p style="margin-top: 16px; font-size: 15px;">Relaxe e foque na gest√£o estrat√©gica. Eu cuido da parte operacional! üíô</p>
                </div>
            </div>

            <h3 style="font-size: 16px; font-weight: 600; margin: 24px 0 16px;">Licen√ßas recentes</h3>

            <div id="licensesList">
                <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                    <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                    <p>Nenhuma licen√ßa cadastrada ainda</p>
                    <p style="font-size: 14px; margin-top: 8px;">Quando um colaborador cadastrar uma licen√ßa, ela aparecer√° aqui automaticamente!</p>
                </div>
            </div>

            <div class="divider"></div>

            <h3 style="font-size: 16px; font-weight: 600; margin: 24px 0 16px;">A√ß√µes pendentes</h3>

            <div class="list-item" style="border-left: 4px solid var(--warning-color);">
                <div class="list-item-content">
                    <h3>Revisar documenta√ß√£o</h3>
                    <p>Pedro Santos aguarda valida√ß√£o de documentos complementares</p>
                </div>
                <div class="list-item-action" style="color: var(--warning-color);">Revisar ‚Üí</div>
            </div>

            <div class="list-item" style="border-left: 4px solid var(--warning-color);">
                <div class="list-item-content">
                    <h3>Atualiza√ß√£o necess√°ria</h3>
                    <p>Juliana Lima - Retorno previsto foi alterado</p>
                </div>
                <div class="list-item-action" style="color: var(--warning-color);">Revisar ‚Üí</div>
            </div>

            <div class="alert alert-info mt-3">
                <strong>üìä Relat√≥rios:</strong> Acesse relat√≥rios detalhados de absente√≠smo e tend√™ncias da equipe atrav√©s do menu principal.
            </div>

            <div style="margin-top: 32px;">
                <a href="tela-05a-confirmacao.html" class="btn btn-primary btn-block">
                    üß™ Simular cadastro de licen√ßa (Teste)
                </a>
                
                <button onclick="clearAllData()" class="btn btn-secondary btn-block">
                    üóëÔ∏è Limpar todos os dados (Reset)
                </button>
            </div>
        </div>
    </div>

    <script>
        let notificationTimeout;

        // Atualizar dashboard ao carregar
        window.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
            
            // Auto-refresh a cada 5 segundos
            setInterval(updateDashboard, 5000);
        });

        // Atualizar estat√≠sticas e lista
        function updateDashboard() {
            const stats = liaSync.getStats();
            
            document.getElementById('statTotal').textContent = stats.total;
            document.getElementById('statActive').textContent = stats.active;
            document.getElementById('statPending').textContent = stats.pending;
            
            // Atualizar lista de licen√ßas
            const licenses = liaSync.getLicenses();
            renderLicenses(licenses);
        }

        // Renderizar lista de licen√ßas
        function renderLicenses(licenses) {
            const container = document.getElementById('licensesList');
            
            if (licenses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                        <p>Nenhuma licen√ßa cadastrada ainda</p>
                        <p style="font-size: 14px; margin-top: 8px;">Quando um colaborador cadastrar uma licen√ßa, ela aparecer√° aqui automaticamente!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // Remover duplicatas baseado no ID
            const uniqueLicenses = [];
            const seenIds = new Set();
            
            licenses.forEach(license => {
                if (!seenIds.has(license.id)) {
                    seenIds.add(license.id);
                    uniqueLicenses.push(license);
                }
            });
            
            uniqueLicenses.forEach(license => {
                const badge = !license.viewedByManager ? '<span class="badge badge-new">NOVA</span>' : '';
                const statusColor = license.status === 'Aguardando INSS' ? 'var(--warning-color)' : 'var(--success-color)';
                const employeeName = license.employeeName || license.employee || 'Colaborador';
                const condition = license.condition || license.injury || 'N√£o especificada';
                const startDate = license.startDate || 'Data n√£o informada';
                const endDate = license.endDate || 'Data n√£o informada';
                const status = license.status || 'Pendente';
                
                html += `
                    <div class="list-item" onclick="viewLicense('${license.id}')" style="cursor: pointer; border-left: 4px solid ${statusColor};">
                        <div class="list-item-content">
                            <h3>${employeeName} ${badge}</h3>
                            <p><strong>Les√£o:</strong> ${condition}</p>
                            <p><strong>Per√≠odo:</strong> ${startDate} at√© ${endDate}</p>
                            <p><strong>Status:</strong> ${status}</p>
                        </div>
                        <div class="list-item-action">Ver detalhes ‚Üí</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Traduzir status
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pendente',
                'active': 'Ativa',
                'completed': 'Conclu√≠da'
            };
            return statusMap[status] || status;
        }

        // Visualizar licen√ßa
        function viewLicense(licenseId) {
            console.log('Visualizando licen√ßa:', licenseId);
            liaSync.markAsViewed(licenseId);
            updateDashboard();
        }

        // Mostrar notifica√ß√£o
        function showNotification(notification) {
            const banner = document.getElementById('notificationBanner');
            
            document.getElementById('notifTitle').textContent = notification.title;
            document.getElementById('notifMessage').textContent = notification.message;
            
            banner.style.display = 'block';
            
            // Auto-esconder ap√≥s 10 segundos
            clearTimeout(notificationTimeout);
            notificationTimeout = setTimeout(() => {
                dismissNotification();
            }, 10000);
        }

        // Esconde notifica√ß√£o
        function dismissNotification() {
            document.getElementById('notificationBanner').style.display = 'none';
        }

        // Listener para novas licen√ßas
        window.addEventListener('lia:newNotification', (e) => {
            console.log('üîî Nova notifica√ß√£o recebida:', e.detail);
            showNotification(e.detail);
            updateDashboard();
        });

        // Listener para dados atualizados
        window.addEventListener('lia:dataUpdated', () => {
            console.log('üîÑ Dados atualizados');
            updateDashboard();
        });

        // Limpar todos os dados
        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados de teste?')) {
                localStorage.removeItem('lia-licenses');
                localStorage.removeItem('lia-notifications');
                updateDashboard();
                alert('‚úÖ Dados limpos com sucesso!');
            }
        }

        // Auto-refresh
        window.addEventListener('lia:autoRefresh', updateDashboard);
    </script>
</body>
</html>
