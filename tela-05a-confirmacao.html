<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Licen√ßa Cadastrada - Lia Care</title>
    <link rel="stylesheet" href="css/style.css?v=20251227">
    <script src="js/lia-sync.js?v=20251227"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">LIA</div>
                <div class="logo-text">
                    <h1>Lia Care</h1>
                    <p>Licen√ßas e Afastamentos</p>
                </div>
            </div>
            <div class="user-info">
                <span>Colaborador</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card text-center" style="max-width: 600px; margin: 40px auto;">
            <div style="font-size: 64px; margin-bottom: 24px;">‚úÖ</div>
            
            <div class="card-header">
                <h2 class="card-title">Licen√ßa cadastrada com sucesso!</h2>
                <p class="card-subtitle">Seus documentos foram recebidos e processados</p>
            </div>

            <div class="divider"></div>

            <div style="text-align: left;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Status do processo:</h3>
                
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <span style="color: var(--success-color); font-size: 20px;">‚úì</span>
                    <div>
                        <div style="font-weight: 500;">Licen√ßa cadastrada</div>
                        <div style="font-size: 13px; color: var(--text-gray);">Documentos validados</div>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <span style="color: var(--success-color); font-size: 20px;">‚úì</span>
                    <div>
                        <div style="font-weight: 500;">Gestor notificado</div>
                        <div style="font-size: 13px; color: var(--text-gray);">Notifica√ß√£o enviada automaticamente</div>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="color: var(--success-color); font-size: 20px;">‚úì</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 500;">DUT gerada</div>
                        <div style="font-size: 13px; color: var(--text-gray);">Declara√ß√£o √önica de Trabalho dispon√≠vel</div>
                    </div>
                    <a href="#" onclick="visualizarDUT(); return false;" class="btn btn-sm" style="background: linear-gradient(135deg, #4299E1, #6B46C1); color: white; padding: 8px 16px; font-size: 13px; text-decoration: none; border-radius: 8px; white-space: nowrap;">
                        üìÑ Ver DUT
                    </a>
                </div>
            </div>

            <div id="dutModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 16px;">
                <div class="dut-modal-content" style="background: white; padding: 24px; border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;">
                    <button onclick="fecharDUT()" style="position: absolute; top: 12px; right: 12px; background: #f7fafc; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 20px; color: #718096; z-index: 10;">‚úï</button>
                    
                    <div style="text-align: center; margin-bottom: 20px; padding-right: 40px;">
                        <div style="font-size: 40px; margin-bottom: 8px;">üìÑ</div>
                        <h3 style="margin: 0 0 8px 0; color: #2d3748; font-size: 20px; line-height: 1.3;">Declara√ß√£o √önica de Trabalho</h3>
                        <p style="color: #718096; font-size: 13px; margin: 0;">DUT - Protocolo #2025-12-27-001</p>
                    </div>

                    <div style="background: #f7fafc; padding: 16px; border-radius: 12px; margin-bottom: 16px; border: 2px solid #e2e8f0;">
                        <div class="dut-grid" style="display: grid; grid-template-columns: 1fr; gap: 16px;">
                            <div>
                                <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">COLABORADOR</div>
                                <div style="font-weight: 600; color: #2d3748; font-size: 15px;">Jo√£o Silva</div>
                                <div style="font-size: 13px; color: #718096;">COL-12345</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">CARGO</div>
                                <div style="font-weight: 600; color: #2d3748; font-size: 15px;">Desenvolvedor Frontend</div>
                                <div style="font-size: 13px; color: #718096;">Tecnologia</div>
                            </div>
                        </div>
                    </div>

                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 13px; color: #4299E1; font-weight: 700; letter-spacing: 0.5px;">DADOS DO AFASTAMENTO</h4>
                        
                        <div style="margin-bottom: 12px;">
                            <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">DIAGN√ìSTICO (CID-10)</div>
                            <div style="font-weight: 600; color: #2d3748; font-size: 14px;">M54.5 - Lombalgia</div>
                        </div>

                        <div class="dut-date-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <div>
                                <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">IN√çCIO</div>
                                <div style="font-weight: 600; color: #2d3748; font-size: 14px;" id="dutStartDate"></div>
                            </div>
                            <div>
                                <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">FIM</div>
                                <div style="font-weight: 600; color: #2d3748; font-size: 14px;" id="dutEndDate"></div>
                            </div>
                        </div>

                        <div>
                            <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">PER√çODO DE AFASTAMENTO</div>
                            <div style="font-weight: 600; color: #2d3748; font-size: 14px;">15 dias corridos</div>
                        </div>
                    </div>

                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 13px; color: #4299E1; font-weight: 700; letter-spacing: 0.5px;">PROFISSIONAL RESPONS√ÅVEL</h4>
                        
                        <div style="margin-bottom: 12px;">
                            <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">M√âDICO</div>
                            <div style="font-weight: 600; color: #2d3748; font-size: 14px;">Dr. Carlos Mendes</div>
                        </div>

                        <div>
                            <div style="font-size: 11px; color: #718096; margin-bottom: 4px; font-weight: 600; letter-spacing: 0.5px;">CRM</div>
                            <div style="font-weight: 600; color: #2d3748; font-size: 14px;">CRM 12345-SP</div>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, rgba(66, 153, 225, 0.1), rgba(107, 70, 193, 0.1)); padding: 14px; border-radius: 12px; border-left: 4px solid #4299E1; margin-bottom: 16px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                            <span style="font-size: 16px;">ü§ñ</span>
                            <strong style="color: #2d3748; font-size: 14px;">Validado por IA</strong>
                        </div>
                        <div style="font-size: 12px; color: #718096; line-height: 1.4;">
                            Documento validado automaticamente em <strong id="dutGeneratedTime"></strong>
                        </div>
                    </div>

                    <div class="dut-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="downloadDUT()" class="btn btn-primary" style="flex: 1; min-width: 140px; font-size: 14px; padding: 12px 20px;">
                            üì• Baixar PDF
                        </button>
                        <button onclick="imprimirDUT()" class="btn btn-secondary" style="flex: 1; min-width: 140px; font-size: 14px; padding: 12px 20px;">
                            üñ®Ô∏è Imprimir
                        </button>
                    </div>
                </div>
            </div>

            <style>
                @media (max-width: 480px) {
                    .dut-modal-content {
                        padding: 20px 16px !important;
                        border-radius: 12px !important;
                    }
                    
                    .dut-grid {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .dut-date-grid {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .dut-actions {
                        flex-direction: column !important;
                    }
                    
                    .dut-actions button {
                        width: 100% !important;
                        min-width: 100% !important;
                    }
                    
                    #dutModal {
                        padding: 12px !important;
                    }
                }
            </style>

            <div class="ai-message mt-3">
                <div class="ai-message-header">
                    <span>ü§ñ</span>
                    <span>LIA - Assistente Inteligente</span>
                </div>
                <div class="ai-message-content">
                    <p style="margin-bottom: 16px; font-size: 17px;"><strong>Tudo certo! ‚ú®</strong></p>
                    <p style="margin-bottom: 12px;">Acabei de processar seu atestado. Olha o que rolou:</p>
                    <ul style="margin: 12px 0; padding-left: 20px; line-height: 2;">
                        <li>‚úÖ <strong>Atestado validado</strong> (conferi tudo: per√≠odo, CID, assinatura)</li>
                        <li>‚úÖ <strong>DUT gerada</strong> automaticamente</li>
                        <li>‚úÖ <strong>Gestor notificado</strong> por e-mail e sistema</li>
                        <li>‚úÖ <strong>RH informado</strong> para processar o afastamento</li>
                    </ul>
                    <p style="margin-top: 16px;"><strong>‚è±Ô∏è Prazo:</strong> Tudo aparece no sistema em at√© <strong>6 dias √∫teis</strong>.</p>
                    <p style="margin-top: 16px; font-size: 16px;"><strong>Agora √© s√≥ focar na sua recupera√ß√£o!</strong> üíô<br>Vou monitorar tudo e te aviso se precisar de algo. Fique tranquilo(a)! üòä</p>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 12px; margin-top: 24px; color: white; text-align: center;">
                <div style="font-size: 36px; margin-bottom: 12px;">üè•</div>
                <h3 style="margin: 0 0 8px 0; font-size: 18px;">Quer dicas para sua recupera√ß√£o?</h3>
                <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">
                    Nossa IA pode te orientar sobre exerc√≠cios, alimenta√ß√£o e cuidados personalizados
                </p>
                <a href="tela-dicas-saude.html" class="btn" style="background-color: white; color: #059669; border: none;">
                    ü§ñ Receber Dicas com IA
                </a>
            </div>

            <div style="margin-top: 32px;">
                <a href="tela-06a-acompanhamento.html" class="btn btn-primary btn-block">
                    Acompanhar minha licen√ßa
                </a>
                
                <a href="tela-01-entrada.html" class="btn btn-secondary btn-block">
                    Voltar ao in√≠cio
                </a>
            </div>
        </div>
    </div>

    <script>
        // Aguarda o liaSync estar pronto antes de criar a licen√ßa
        function waitForLiaSync() {
            if (!window.liaSync) {
                console.log('‚è≥ Aguardando liaSync carregar...');
                setTimeout(waitForLiaSync, 100);
                return;
            }
            
            console.log('‚úÖ liaSync carregado!');
            createLicense();
        }
        
        function createLicense() {
            console.log('üìù P√°gina de confirma√ß√£o - criando licen√ßa');
            console.log('üì¶ liaSync dispon√≠vel:', !!window.liaSync);
            
            // Limpa o sessionStorage para permitir recriar
            sessionStorage.removeItem('license-created-joao-silva');
            
            console.log('‚ûï Criando nova licen√ßa...');
            
            // Dados simulados do colaborador (em produ√ß√£o viriam do formul√°rio anterior)
            const licenseData = {
                employeeName: 'Jo√£o Silva',
                employeeId: 'COL-12345',
                position: 'Desenvolvedor Frontend',
                department: 'Tecnologia',
                manager: 'Maria Santos',
                cid: 'M54.5',
                condition: 'Lombalgia',
                days: 15,
                startDate: new Date().toLocaleDateString('pt-BR'),
                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR'),
                doctorName: 'Dr. Carlos Mendes',
                doctorCRM: 'CRM 12345-SP'
            };

            console.log('üìã Dados da licen√ßa:', licenseData);

            // Cadastra no sistema e notifica gestor
            const license = window.liaSync.createLicense(licenseData);
            sessionStorage.setItem('license-created-joao-silva', 'true');
            
            console.log('‚úÖ Licen√ßa cadastrada:', license);
            console.log('üìß Gestor notificado automaticamente!');
            
            // Verifica se foi salvo
            setTimeout(() => {
                const licenses = window.liaSync.getLicenses();
                console.log('üìä Total de licen√ßas ap√≥s criar:', licenses.length);
                console.log('üìä Licen√ßas:', licenses);
            }, 500);
        }
        
        // Inicia quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', waitForLiaSync);
        
        function visualizarDUT() {
            const modal = document.getElementById('dutModal');
            modal.style.display = 'flex';
            
            // Preenche as datas
            const startDate = new Date().toLocaleDateString('pt-BR');
            const endDate = new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR');
            const generatedTime = new Date().toLocaleString('pt-BR');
            
            document.getElementById('dutStartDate').textContent = startDate;
            document.getElementById('dutEndDate').textContent = endDate;
            document.getElementById('dutGeneratedTime').textContent = generatedTime;
        }

        function fecharDUT() {
            const modal = document.getElementById('dutModal');
            modal.style.display = 'none';
        }

        function downloadDUT() {
            alert('üì• Fun√ß√£o de download do PDF da DUT ser√° implementada em produ√ß√£o.\n\nO documento seria gerado com os dados oficiais e assinatura digital.');
        }

        function imprimirDUT() {
            alert('üñ®Ô∏è Fun√ß√£o de impress√£o ser√° implementada em produ√ß√£o.\n\nO documento seria formatado para impress√£o com layout oficial.');
        }

        // Fechar modal ao clicar fora
        document.getElementById('dutModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                fecharDUT();
            }
        });
    </script>
</body>
</html>
