<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da Licen√ßa - Lia Care</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/lia-sync.js?v=20251228"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">LIA</div>
                <div class="logo-text">
                    <h1>Lia Care</h1>
                    <p>Licen√ßas e Afastamentos</p>
                </div>
            </div>
            <div class="user-info">
                <span>üëî</span>
                <span>Maria Santos - Gestora</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="card" style="max-width: 900px; margin: 40px auto;">
            <div class="card-header">
                <h2 class="card-title">Detalhes da Licen√ßa</h2>
                <p class="card-subtitle">Acompanhamento completo do afastamento</p>
            </div>

            <div style="background-color: var(--bg-light); padding: 24px; border-radius: 8px; margin-bottom: 24px;" id="employeeHeader">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                    <div id="employeeAvatar" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), #3b82f6); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 600;">
                        --
                    </div>
                    <div>
                        <h3 id="employeeName" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">Carregando...</h3>
                        <p id="employeePosition" style="color: var(--text-gray); margin-bottom: 8px;">...</p>
                        <span id="licenseStatus" class="status-badge status-pending">...</span>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Per√≠odo da licen√ßa</div>
                    <div id="licenseDays" class="stat-value" style="font-size: 24px;">-- dias</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Data de in√≠cio</div>
                    <div id="startDate" class="stat-value" style="font-size: 20px;">--/--/----</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Retorno previsto</div>
                    <div id="endDate" class="stat-value" style="font-size: 20px;">--/--/----</div>
                </div>
            </div>

            <div class="divider"></div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                <div>
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Informa√ß√µes do processo</h3>
                    <div id="processInfo" style="display: grid; gap: 12px;">
                        <div>
                            <div style="font-size: 13px; color: var(--text-gray); margin-bottom: 4px;">Tipo de licen√ßa</div>
                            <div id="licenseType" style="font-weight: 500;">Carregando...</div>
                        </div>
                        <div>
                            <div style="font-size: 13px; color: var(--text-gray); margin-bottom: 4px;">Condi√ß√£o/Les√£o</div>
                            <div id="condition" style="font-weight: 500;">Carregando...</div>
                        </div>
                        <div>
                            <div style="font-size: 13px; color: var(--text-gray); margin-bottom: 4px;">M√©dico respons√°vel</div>
                            <div id="doctorInfo" style="font-weight: 500;">Carregando...</div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Documentos</h3>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background-color: var(--bg-white); border: 1px solid var(--border-color); border-radius: 6px;">
                            <span style="font-size: 20px;">üìÑ</span>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; font-weight: 500;">Atestado m√©dico</div>
                                <div style="font-size: 12px; color: var(--text-gray);">Validado</div>
                            </div>
                            <span style="color: var(--success-color); font-size: 16px;">‚úì</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background-color: var(--bg-white); border: 1px solid var(--border-color); border-radius: 6px;">
                            <span style="font-size: 20px;">üìã</span>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; font-weight: 500;">DUT gerada</div>
                                <div style="font-size: 12px; color: var(--text-gray);">Autom√°tico</div>
                            </div>
                            <span style="color: var(--success-color); font-size: 16px;">‚úì</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background-color: var(--bg-white); border: 1px solid var(--border-color); border-radius: 6px;">
                            <span style="font-size: 20px;">üìé</span>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; font-weight: 500;">Protocolo INSS</div>
                                <div style="font-size: 12px; color: var(--text-gray);">Enviado</div>
                            </div>
                            <span style="color: var(--success-color); font-size: 16px;">‚úì</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Linha do tempo</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-title">Licen√ßa registrada</div>
                    <div class="timeline-desc">Colaborador enviou documenta√ß√£o e registrou licen√ßa</div>
                    <div class="timeline-date">26/12/2025 √†s 14:30</div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-title">Processo INSS iniciado</div>
                    <div class="timeline-desc">An√°lise documental em andamento</div>
                    <div class="timeline-date">20/12/2025 √†s 10:15</div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-title">Aguardando decis√£o</div>
                    <div class="timeline-desc">Prazo de an√°lise: at√© 45 dias √∫teis</div>
                    <div class="timeline-date">Em andamento</div>
                </div>
            </div>

            <div class="ai-message mt-3">
                <div class="ai-message-header">
                    <span>ü§ñ</span>
                    <span>LIA - Assistente Inteligente</span>
                </div>
                <div class="ai-message-content">
                    <p style="margin-bottom: 12px;"><strong>Estou acompanhando este caso ativamente.</strong></p>
                    <p style="margin-bottom: 12px;">Jo√£o est√° sendo orientado por mim em cada etapa. Veja o que estou gerenciando:</p>
                    <ul style="margin: 12px 0; padding-left: 20px; line-height: 1.8;">
                        <li>üìã Valida√ß√£o cont√≠nua de documentos e prazos</li>
                        <li>üîç Monitoramento do processo INSS (verifico a cada 6h)</li>
                        <li>üí¨ Comunica√ß√£o direta com o colaborador quando necess√°rio</li>
                        <li>üìä Atualiza√ß√£o autom√°tica do status para voc√™</li>
                        <li>‚ö†Ô∏è Alerta sobre a√ß√µes necess√°rias ou pend√™ncias</li>
                    </ul>
                    <p style="margin-top: 12px;"><strong>Voc√™ s√≥ precisa acompanhar.</strong> Vou te notificar se algo exigir sua aten√ß√£o. O colaborador est√° em boas m√£os! üíô</p>
                </div>
            </div>

            <div class="alert alert-info mt-3">
                <strong>üëÅÔ∏è Modo visualiza√ß√£o:</strong> Como gestor, voc√™ acompanha o status da licen√ßa mas n√£o edita documentos. O colaborador √© respons√°vel por manter as informa√ß√µes atualizadas.
            </div>

            <div style="margin-top: 32px;">
                <a href="tela-g1-visao-geral.html" class="btn btn-secondary btn-block">
                    ‚Üê Voltar √† vis√£o geral
                </a>
            </div>
        </div>
    </div>

    <script>
        // Aguarda o liaSync estar pronto antes de carregar
        function waitForLiaSync() {
            if (!window.liaSync) {
                console.log('‚è≥ Aguardando liaSync carregar...');
                setTimeout(waitForLiaSync, 100);
                return;
            }
            console.log('‚úÖ liaSync carregado!');
            loadLicenseDetails();
        }

        // Carrega dados da licen√ßa
        window.addEventListener('DOMContentLoaded', () => {
            waitForLiaSync();
        });

        function loadLicenseDetails() {
            // Pega o ID da URL ou sessionStorage
            const urlParams = new URLSearchParams(window.location.search);
            const licenseId = urlParams.get('id') || sessionStorage.getItem('currentLicenseId');
            
            console.log('üîç Buscando licen√ßa com ID:', licenseId);
            
            if (!licenseId) {
                alert('Licen√ßa n√£o encontrada');
                window.location.href = 'tela-g1-visao-geral.html';
                return;
            }

            // Busca a licen√ßa
            const licenses = liaSync.getLicenses();
            console.log('üì¶ Total de licen√ßas:', licenses.length);
            
            const license = licenses.find(l => l.id === licenseId);

            if (!license) {
                console.error('‚ùå Licen√ßa n√£o encontrada. ID:', licenseId);
                console.log('Licen√ßas dispon√≠veis:', licenses.map(l => l.id));
                alert('Licen√ßa n√£o encontrada');
                window.location.href = 'tela-g1-visao-geral.html';
                return;
            }

            console.log('‚úÖ Licen√ßa encontrada:', license);

            // Preenche os dados
            const employeeName = license.employeeName || license.employee || 'Colaborador';
            const initials = getInitials(employeeName);
            
            document.getElementById('employeeAvatar').textContent = initials;
            document.getElementById('employeeName').textContent = employeeName;
            
            const position = license.position || 'Cargo n√£o informado';
            const department = license.department || 'Departamento n√£o informado';
            document.getElementById('employeePosition').textContent = `${position} ‚Ä¢ ${department}`;
            
            const status = license.status || 'Pendente';
            const statusBadge = document.getElementById('licenseStatus');
            statusBadge.textContent = status;
            statusBadge.className = 'status-badge ' + getStatusClass(status);
            
            document.getElementById('licenseDays').textContent = (license.days || '--') + ' dias';
            document.getElementById('startDate').textContent = license.startDate || '--/--/----';
            document.getElementById('endDate').textContent = license.endDate || '--/--/----';
            
            const licenseType = license.days > 15 ? 'Licen√ßa m√©dica (INSS)' : 'Licen√ßa m√©dica (at√© 15 dias)';
            document.getElementById('licenseType').textContent = licenseType;
            
            document.getElementById('condition').textContent = license.condition || license.injury || 'N√£o especificada';
            
            const doctorName = license.doctorName || 'N√£o informado';
            const doctorCRM = license.doctorCRM || '';
            document.getElementById('doctorInfo').textContent = doctorCRM ? `${doctorName} - ${doctorCRM}` : doctorName;
            
            console.log('‚úÖ Dados da licen√ßa carregados:', license);
        }

        function getInitials(name) {
            const parts = name.trim().split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        function getStatusClass(status) {
            const statusMap = {
                'Aguardando INSS': 'status-pending',
                'Em an√°lise': 'status-pending',
                'Aprovada': 'status-approved',
                'Deferida': 'status-approved',
                'Ativa': 'status-approved',
                'Conclu√≠da': 'status-completed',
                'Indeferida': 'status-denied'
            };
            return statusMap[status] || 'status-pending';
        }
    </script>
</body>
</html>
